# H.264/H.265 SEI解析器

一个轻量级的SEI（Supplemental Enhancement Information）解析器，支持从多种视频文件格式中提取和解析SEI数据。

## 特性

- **多格式支持**: FLV、MP4、H.264裸流、H.265裸流
- **零依赖**: 仅使用Python标准库
- **详细输出**: 显示SEI类型、大小、16进制数据和字符串内容
- **JSON解析**: 自动识别和解析JSON格式的SEI数据
- **H.264/H.265兼容**: 支持两种主流编码标准

## 使用方法

```bash
python3 sei_parser.py <文件路径>
```

### 支持的文件格式

- `.flv` - Flash Video
- `.mp4` - MPEG-4 Part 14
- `.h264`, `.264` - H.264裸流
- `.h265`, `.265`, `.hevc` - H.265裸流

## 输出格式

对于每个找到的SEI payload，解析器会显示：

```
SEI #1:
  编解码器: H.264
  SEI类型: 100 (unknown_100)
  数据大小: 372 字节
  16进制数据: 7b0a202020226c6976655f...
  字符串内容: '{"key": {...}}'
  JSON内容: {
    "key": {
      "value": 0
    },
    ...
  }
```

## 示例

使用提供的测试文件：

```bash
python3 sei_parser.py 22.flv
```

## SEI类型说明

解析器包含了完整的SEI类型映射表，涵盖：

- **标准SEI类型** (0-54): 如buffering_period、pic_timing、user_data等
- **H.265扩展类型** (128-172): 如active_parameter_sets、mastering_display_colour_volume等
- **自定义类型**: 显示为unknown_XXX格式

## 技术实现

### 核心功能

1. **文件格式检测**: 根据文件扩展名和内容自动识别格式
2. **容器解析**: 从FLV/MP4容器中提取视频流
3. **NALU解析**: 识别和解析H.264/H.265的NAL单元
4. **SEI提取**: 解析SEI NALU中的payload数据
5. **数据转换**: 将二进制数据转换为可读格式

### 关键算法

- **起始码检测**: 支持3字节和4字节起始码
- **长度编码解析**: 处理SEI的可变长度编码
- **字符编码处理**: UTF-8解码和错误处理
- **JSON验证**: 自动检测和解析JSON格式数据

## 扩展性

代码结构清晰，易于扩展：

- 添加新的容器格式支持
- 扩展SEI类型定义
- 增加特定SEI类型的专门解析器
- 添加输出格式选项（如XML、CSV等）

## 注意事项

1. **文件大小**: 大文件可能需要较长处理时间
2. **内存使用**: 整个文件会加载到内存中
3. **错误处理**: 损坏的文件可能导致解析失败
4. **编码支持**: 主要针对UTF-8编码的字符串数据

## 许可证

本项目使用MIT许可证，可自由使用和修改。